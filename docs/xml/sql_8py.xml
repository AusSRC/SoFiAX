<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.1" xml:lang="en-US">
  <compounddef id="sql_8py" kind="file" language="Python">
    <compoundname>sql.py</compoundname>
    <innernamespace refid="namespacesrc_1_1utils_1_1sql">src::utils::sql</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="keyword">import</highlight><highlight class="normal"><sp/>json</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>sofiax.schema<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Run,<sp/>Instance,<sp/>Detection</highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal">async<sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">db_run_upsert(conn,<sp/>run:<sp/>Run):</highlight></codeline>
<codeline lineno="6"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Add<sp/>a<sp/>Run<sp/>object<sp/>into<sp/>the<sp/>database.</highlight></codeline>
<codeline lineno="7"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="8"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"><sp/><sp/><sp/><sp/>run_id<sp/>=<sp/>await<sp/>conn.fetchrow(</highlight><highlight class="stringliteral">&apos;INSERT<sp/>INTO<sp/>wallaby.run<sp/>(name,<sp/>sanity_thresholds)<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;VALUES($1,<sp/>$2)<sp/>ON<sp/>CONFLICT<sp/>(name,<sp/>sanity_thresholds)<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;DO<sp/>UPDATE<sp/>SET<sp/>name=EXCLUDED.name<sp/>RETURNING<sp/>id&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="12"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>run.name,<sp/>json.dumps(run.sanity_thresholds))</highlight></codeline>
<codeline lineno="13"><highlight class="normal"><sp/><sp/><sp/><sp/>run.run_id<sp/>=<sp/>run_id[0]</highlight></codeline>
<codeline lineno="14"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>run</highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal">async<sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">db_instance_upsert(conn,<sp/>instance:<sp/>Instance):</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Add<sp/>an<sp/>Instance<sp/>object<sp/>into<sp/>the<sp/>database.</highlight></codeline>
<codeline lineno="19"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="20"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"><sp/><sp/><sp/><sp/>ins_id<sp/>=<sp/>await<sp/>conn.fetchrow(</highlight><highlight class="stringliteral">&apos;INSERT<sp/>INTO<sp/>wallaby.instance<sp/>(run_id,<sp/>run_date,<sp/>filename,<sp/>boundary,<sp/>flag_log,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;reliability_plot,<sp/>log,<sp/>parameters,<sp/>version,<sp/>return_code,<sp/>stdout,<sp/>stderr)<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;VALUES($1,<sp/>$2,<sp/>$3,<sp/>$4,<sp/>$5,<sp/>$6,<sp/>$7,<sp/>$8,<sp/>$9,<sp/>$10,<sp/>$11,<sp/>$12)<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;ON<sp/>CONFLICT<sp/>(run_id,<sp/>filename,<sp/>boundary)<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;DO<sp/>UPDATE<sp/>SET<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;run_date=EXCLUDED.run_date,&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;filename=EXCLUDED.filename,&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;boundary=EXCLUDED.boundary,&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;flag_log=EXCLUDED.flag_log,&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;reliability_plot=EXCLUDED.reliability_plot,&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;log=EXCLUDED.log,&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;parameters=EXCLUDED.parameters,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;version=EXCLUDED.version,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;return_code=EXCLUDED.return_code,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;stdout=EXCLUDED.stdout,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;stderr=EXCLUDED.stderr<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;RETURNING<sp/>id&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>instance.run_id,<sp/>instance.run_date,<sp/>instance.filename,<sp/>instance.boundary,</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>instance.flag_log,<sp/>instance.reliability_plot,<sp/>instance.log,</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>json.dumps(instance.params),<sp/>instance.version,<sp/>instance.return_code,</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>instance.stdout,<sp/>instance.stderr)</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/>instance.instance_id<sp/>=<sp/>ins_id[0]</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>instance</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal">async<sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">db_source_match(conn,<sp/>run_id:<sp/>int,<sp/>detection:<sp/>dict,<sp/>uncertainty_sigma:<sp/>int):</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Check<sp/>if<sp/>a<sp/>detection<sp/>matches<sp/>another<sp/>detection<sp/>in<sp/>the<sp/>database.</highlight></codeline>
<codeline lineno="48"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="49"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/>x<sp/>=<sp/>detection[</highlight><highlight class="stringliteral">&apos;x&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/>y<sp/>=<sp/>detection[</highlight><highlight class="stringliteral">&apos;y&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/>z<sp/>=<sp/>detection[</highlight><highlight class="stringliteral">&apos;z&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/>err_x<sp/>=<sp/>detection[</highlight><highlight class="stringliteral">&apos;err_x&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/>err_y<sp/>=<sp/>detection[</highlight><highlight class="stringliteral">&apos;err_y&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/>err_z<sp/>=<sp/>detection[</highlight><highlight class="stringliteral">&apos;err_z&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/>result<sp/>=<sp/>await<sp/>conn.fetch(</highlight><highlight class="stringliteral">&apos;SELECT<sp/>d.id,<sp/>d.instance_id,<sp/>x,<sp/>y,<sp/>z,<sp/>f_sum,<sp/>ell_maj,<sp/>ell_min,<sp/>w50,<sp/>w20,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;flag,<sp/>unresolved<sp/>FROM<sp/>wallaby.detection<sp/>as<sp/>d,<sp/>wallaby.instance<sp/>as<sp/>i<sp/>WHERE<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;ST_3DDistance(geometry(ST_MakePoint($1,<sp/>$2,<sp/>0)),<sp/>geometry(ST_MakePoint(x,<sp/>y,<sp/>0)))<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f</highlight><highlight class="stringliteral">&apos;&lt;=<sp/>{uncertainty_sigma}<sp/>*<sp/>SQRT((($1<sp/>-<sp/>x)^2<sp/>*<sp/>($4^2<sp/>+<sp/>err_x^2)<sp/>+<sp/>($2<sp/>-<sp/>y)^2<sp/>*<sp/>($5^2<sp/>+<sp/>err_y^2))<sp/>/<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;COALESCE(NULLIF((($1<sp/>-<sp/>x)^2<sp/>+<sp/>($2<sp/>-<sp/>y)^2),<sp/>0),<sp/>1))<sp/>AND<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;ST_3DDistance(geometry(ST_MakePoint(0,<sp/>0,<sp/>$3)),<sp/>geometry(ST_MakePoint(0,<sp/>0,<sp/>z)))<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f</highlight><highlight class="stringliteral">&apos;&lt;=<sp/>{uncertainty_sigma}<sp/>*<sp/>SQRT($6<sp/>^<sp/>2<sp/>+<sp/>err_z<sp/>^<sp/>2)<sp/>AND<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;d.instance_id<sp/>=<sp/>i.id<sp/>AND<sp/>i.run_id<sp/>=<sp/>$7<sp/>ORDER<sp/>BY<sp/>d.id<sp/>ASC<sp/>FOR<sp/>UPDATE<sp/>OF<sp/>d&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x,<sp/>y,<sp/>z,<sp/>err_x,<sp/>err_y,<sp/>err_z,<sp/>run_id)</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>i,<sp/>j<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>enumerate(result):</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>do<sp/>not<sp/>want<sp/>the<sp/>original<sp/>detection<sp/>if<sp/>it<sp/>already<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>j[</highlight><highlight class="stringliteral">&apos;x&apos;</highlight><highlight class="normal">]<sp/>==<sp/>x<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>j[</highlight><highlight class="stringliteral">&apos;y&apos;</highlight><highlight class="normal">]<sp/>==<sp/>y<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>j[</highlight><highlight class="stringliteral">&apos;z&apos;</highlight><highlight class="normal">]<sp/>==<sp/>z:</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result.pop(i)</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal">async<sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">db_detection_product_insert(conn,<sp/>detection_id,<sp/>cube,<sp/>mask,<sp/>mom0,<sp/>mom1,<sp/>mom2,<sp/>chan,<sp/>spec):</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/>product_id<sp/>=<sp/>await<sp/>conn.fetchrow(</highlight><highlight class="stringliteral">&apos;INSERT<sp/>INTO<sp/>wallaby.products<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;(detection_id,<sp/>cube,<sp/>mask,<sp/>moment0,<sp/>moment1,<sp/>moment2,<sp/>channels,<sp/>spectrum)<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;VALUES($1,<sp/>$2,<sp/>$3,<sp/>$4,<sp/>$5,<sp/>$6,<sp/>$7,<sp/>$8)<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;ON<sp/>CONFLICT<sp/>(detection_id)<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;DO<sp/>UPDATE<sp/>SET<sp/>detection_id=EXCLUDED.detection_id<sp/>RETURNING<sp/>id&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection_id,<sp/>cube,<sp/>mask,<sp/>mom0,<sp/>mom1,<sp/>mom2,<sp/>chan,<sp/>spec)</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>product_id[0]</highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal">async<sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">db_detection_insert(conn,<sp/>run_id:<sp/>int,<sp/>instance_id:<sp/>int,<sp/>detection:<sp/>dict,</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cube:<sp/>bytes,<sp/>mask:<sp/>bytes,<sp/>mom0:<sp/>bytes,<sp/>mom1:<sp/>bytes,<sp/>mom2:<sp/>bytes,<sp/>chan:<sp/>bytes,<sp/>spec:<sp/>bytes,</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unresolved:<sp/>bool<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;run_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>run_id</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;instance_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>instance_id</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;unresolved&apos;</highlight><highlight class="normal">]<sp/>=<sp/>unresolved</highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>_,<sp/>key<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>enumerate(Detection.SCHEMA):</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>detection.get(key,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection[key]<sp/>=<sp/>Detection.SCHEMA[key]</highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/>detection_id<sp/>=<sp/>await<sp/>conn.fetchrow(</highlight><highlight class="stringliteral">&apos;INSERT<sp/>INTO<sp/>wallaby.detection<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;(run_id,<sp/>instance_id,<sp/>unresolved,<sp/>name,<sp/>x,<sp/>y,<sp/>z,<sp/>x_min,<sp/>x_max,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;y_min,<sp/>y_max,<sp/>z_min,<sp/>z_max,<sp/>n_pix,<sp/>f_min,<sp/>f_max,<sp/>f_sum,<sp/>rel,<sp/>flag,<sp/>rms,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;w20,<sp/>w50,<sp/>ell_maj,<sp/>ell_min,<sp/>ell_pa,<sp/>ell3s_maj,<sp/>ell3s_min,<sp/>ell3s_pa,<sp/>kin_pa,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;err_x,<sp/>err_y,<sp/>err_z,<sp/>err_f_sum,<sp/>ra,<sp/>dec,<sp/>freq,<sp/>l,<sp/>b,<sp/>v_rad,<sp/>v_opt,<sp/>v_app,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;access_url)<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;VALUES($1,<sp/>$2,<sp/>$3,<sp/>$4,<sp/>$5,<sp/>$6,<sp/>$7,<sp/>$8,<sp/>$9,<sp/>$10,<sp/>$11,<sp/>$12,<sp/>$13,<sp/>$14,<sp/>$15,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;$16,<sp/>$17,<sp/>$18,<sp/>$19,<sp/>$20,<sp/>$21,<sp/>$22,<sp/>$23,<sp/>$24,<sp/>$25,<sp/>$26,<sp/>$27,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;$28,<sp/>$29,<sp/>$30,<sp/>$31,<sp/>$32,<sp/>$33,<sp/>$34,<sp/>$35,<sp/>$36,<sp/>$37,<sp/>$38,<sp/>$39,<sp/>$40,<sp/>$41,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;$42<sp/>||<sp/>currval(pg_get_serial_sequence(\&apos;wallaby.detection\&apos;,<sp/>\&apos;id\&apos;)))<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;ON<sp/>CONFLICT<sp/>(name,<sp/>x,<sp/>y,<sp/>z,<sp/>x_min,<sp/>x_max,<sp/>y_min,<sp/>y_max,<sp/>z_min,<sp/>z_max,<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;n_pix,<sp/>f_min,<sp/>f_max,<sp/>f_sum,<sp/>instance_id,<sp/>run_id)<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;DO<sp/>UPDATE<sp/>SET<sp/>ra=EXCLUDED.ra<sp/>RETURNING<sp/>id&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;run_id&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;instance_id&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;unresolved&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;x&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;y&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;z&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;x_min&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;x_max&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;y_min&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;y_max&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;z_min&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;z_max&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;n_pix&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;f_min&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;f_max&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;f_sum&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;rel&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;flag&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;rms&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;w20&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;w50&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;ell_maj&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;ell_min&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;ell_pa&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;ell3s_maj&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;ell3s_min&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;ell3s_pa&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;kin_pa&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;err_x&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;err_y&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;err_z&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;err_f_sum&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;ra&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;dec&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;freq&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;l&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>detection[</highlight><highlight class="stringliteral">&apos;b&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;v_rad&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;v_opt&apos;</highlight><highlight class="normal">],<sp/>detection[</highlight><highlight class="stringliteral">&apos;v_app&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Detection.VO_DATALINK_URL)</highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/>await<sp/>db_detection_product_insert(conn,<sp/>detection_id[0],<sp/>cube,<sp/>mask,<sp/>mom0,<sp/>mom1,<sp/>mom2,<sp/>chan,<sp/>spec)</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>detection_id[0]</highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal">async<sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">db_delete_detection(conn,<sp/>detection_id:<sp/>int):</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/>await<sp/>conn.fetchrow(</highlight><highlight class="stringliteral">&apos;DELETE<sp/>FROM<sp/>wallaby.detection<sp/>WHERE<sp/>id=$1&apos;</highlight><highlight class="normal">,<sp/>detection_id)</highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal">async<sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">db_update_detection_unresolved(conn,<sp/>unresolved:<sp/>bool,<sp/>detection_id_list:<sp/>list):</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/>await<sp/>conn.fetchrow(</highlight><highlight class="stringliteral">&apos;UPDATE<sp/>wallaby.detection<sp/>SET<sp/>unresolved=$1<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;WHERE<sp/>id<sp/>=<sp/>ANY($2::bigint[])&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unresolved,<sp/>detection_id_list)</highlight></codeline>
    </programlisting>
    <location file="/Users/she393/Dropbox/projects/RADEC/portal/SoFiAX/src/utils/sql.py"/>
  </compounddef>
</doxygen>
